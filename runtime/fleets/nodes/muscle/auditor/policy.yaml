# Heiwa Auditor Policy (The Law)
# This file defines the static rules that R1 must enforce during CODE_REVIEW jobs.

version: "1.0"
doctrine: "The Repository is the Reality. Code must be atomic, secure, and deterministic."

rules:
  security:
    - name: "no_hardcoded_secrets"
      description: "Detect explicit API keys, tokens, or passwords in source code."
      severity: "CRITICAL"
      pattern: "api_key|token|secret|password|passwd|auth"
      exception: "env variables, tests with mock data"

    - name: "no_public_ips"
      description: "Detect hardcoded IP addresses (except 127.0.0.1 or 100.x.y.z Tailscale)."
      severity: "WARNING"
      pattern: "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"

  quality:
    - name: "atomic_functions"
      description: "Functions should do one thing. Flag complexity if > 1 function call deep."
      severity: "INFO"

    - name: "no_inefficient_loops"
      description: "Detect O(n^2) nested loops or redundant iterations."
      severity: "WARNING"

    - name: "no_magic_numbers"
      description: "Flag unexplained integer constants."
      severity: "INFO"

output_schema:
  format: "markdown"
  template: |
    ## Auditor Verdict: {{ VERDICT }} (Score: {{ SCORE }}/100)
    
    ### Critical Issues
    {{ CRITICAL_ISSUES }}
    
    ### Warnings
    {{ WARNINGS }}
    
    ### Suggestions
    {{ SUGGESTIONS }}
